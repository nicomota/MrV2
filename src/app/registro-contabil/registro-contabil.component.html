<!-- registro-contabil.component.html -->
<div class="pagina">
  <aside class="sidebar">
    <div class="logo">mister <strong>contador</strong></div>
    <nav>
      <ul>
        <li class="active"><i class="bx bx-user"></i> Clientes</li>
        <li><i class="bx bx-bar-chart-alt"></i> Estatísticas</li>
        <li><i class="bx bx-book"></i> Registro Contábil</li>
        <li><i class="bx bx-bank"></i> Extrato Bancário</li>
        <li><i class="bx bx-receipt"></i> Comprovante de Pagto</li>
        <li><i class="bx bx-file"></i> NF-E</li>
        <li><i class="bx bx-cog"></i> Parâmetros - Regras</li>
        <li><i class="bx bx-credit-card"></i> Cartões - Débito/Crédito</li>
        <li><i class="bx bx-transfer"></i> Integrações Realizadas</li>
        <li><i class="bx bx-log-out"></i> Sair</li>
      </ul>
    </nav>
  </aside>

  <main class="conteudo">
    <header class="topo">
      <h1>Registro Contábil</h1>
      <div class="filtros">

        <div class="dropdown">
          <button class="btn btn-outline-seundary dropdown-toggle" data-bs-toggle="dropdown">
            <img class="bank-img"
              src="https://yt3.googleusercontent.com/YoY6PQUzk6UXJEW8sTYs8zf_TfPLHNLSim65mswp_w5CX0jYgtl_le41QPRwoI1Hyj4OM2q_=s900-c-k-c0x00ffffff-no-rj">
            3174 / 40106
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">
                <img class="bank-img"
                  src="https://play-lh.googleusercontent.com/dLVmnD6SlKMWO8_iiw5Cepca0zqmJq3zMaAfXXp6kJfrVBgctX2qTClAOCuaCLn-XmQ">
                0001 / 545498</a></li>
          </ul>
        </div>
        <button type="button" class="btn btn-outline-primary">7-111.02.0001</button>
        <div class="calendario-principal-container">
          <div class="calendario-principal-input" (click)="abrirCalendarioPrincipal()">
            <span>{{ formatarDataExibicaoPrincipal() }}</span>
            <i class="bx bx-calendar"></i>
          </div>

          <!-- Calendário Principal Completo -->
          <div class="calendario-principal" *ngIf="mostrarCalendarioPrincipal" (click)="$event.stopPropagation()">
            <div class="calendario-header">
              <button type="button" (click)="alterarAnoPrincipal(-1)" class="nav-btn">
                <i class="bx bx-chevrons-left"></i>
              </button>

              <span class="calendario-title">{{ anoCalendarioPrincipal }}</span>

              <button type="button" (click)="alterarAnoPrincipal(1)" class="nav-btn">
                <i class="bx bx-chevrons-right"></i>
              </button>
            </div>

            <div class="calendario-grid-meses">
              <div *ngFor="let mes of getMesesDoAno(); let i = index"
                   class="calendario-mes-cell"
                   [class.mes-atual]="isMesAtualPrincipal(i)"
                   [class.mes-selecionado]="isMesSelecionadoPrincipal(i)"
                   (click)="selecionarMesPrincipal(i)">
                {{ mes }}
              </div>
            </div>

            <div class="calendario-footer">
              <button type="button" (click)="fecharCalendarioPrincipal()" class="btn-fechar">Fechar</button>
            </div>
          </div>
        </div>
        <input type="text" placeholder="Pesquisar..." class="pesquisa" />
        <!-- Botões à direita dos filtros -->
        <div class="acoes-botoes d-flex align-items-center gap-2 ms-auto">
          <button class="btn btn-primary">
            <i class="bx bx-list-ul"></i>
          </button>

          <!-- Dropdown "Ações" -->
          <div class="dropdown">
            <button class="btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
              Ações
            </button>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item disabled" href="#">Exportar Lançamentos Contábeis</a></li>
              <li><a class="dropdown-item disabled" href="#">Exportar Baixa NF-e Entrada</a></li>
              <li><a class="dropdown-item disabled" href="#">Exportar Baixa NF-e Saída</a></li>
              <li><a class="dropdown-item disabled" href="#">Exportar Baixa NFS-e Tomado</a></li>
              <li><a class="dropdown-item disabled" href="#">Exportar Baixa NFS-e Prestado</a></li>
              <li><a class="dropdown-item disabled" href="#">Exportar Simples Conferência</a></li>
              <li><a class="dropdown-item disabled" href="#">Gerar Ticket</a></li>
            </ul>
          </div>

          <!-- Botão Excluir -->
          <button class="btn btn-primary">Excluir</button>
        </div>

      </div>

    </header>
    <hr />
    <section class="abas">
      <button [ngClass]="{ 'ativa': abaSelecionada === 'lancamentos' }" (click)="selecionarAba('lancamentos')">
        Lançamentos <span class="badge azul">0002</span>
      </button>
      <button [ngClass]="{ 'ativa': abaSelecionada === 'conciliados' }" (click)="selecionarAba('conciliados')">
        Conciliados <span class="badge verde">0003</span>
      </button>
      <button [ngClass]="{ 'ativa': abaSelecionada === 'naoConciliados' }" (click)="selecionarAba('naoConciliados')">
        Não-Conciliados <span class="badge vermelho">0002</span>
      </button>
    </section>

    <section class="tabela"
             [ngClass]="{
               'tabela-lancamentos': abaSelecionada === 'lancamentos',
               'tabela-conciliados': abaSelecionada === 'conciliados',
               'tabela-nao-conciliados': abaSelecionada === 'naoConciliados'
             }">
      <table>
        <thead>
          <tr>
            <th>Data</th>
            <th>Classificação</th>
            <th>Conta<br>Débito</th>
            <th>Conta<br>Crédito</th>
            <th>Valor</th>
            <th>Histórico</th>
            <th>Comprovante </th>
            <th>Nota</th>
            <th>Cliente</th>
            <th>Anexos</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let linha of dadosLancamentos; let i = index" (click)="abrirModal(i)" style="cursor: pointer;">
            <td>{{ linha.data }}</td>
            <td>{{ linha.classificacao }}</td>

            <!-- Conta Débito (ícone só se houver crédito) -->
            <td>
              <i class="bx bx-book icone-clicavel" *ngIf="linha.debito && !linha.credito"></i>
              {{ linha.debito }}
            </td>

            <!-- Conta Crédito (ícone só se crédito estiver vazio, e houver débito) -->
            <td>
              <i class="bx bx-book icone-clicavel" *ngIf="linha.credito && !linha.debito"></i>
              {{ linha.credito }}
            </td>

            <td>{{ linha.valor }}</td>

            <td class="conta-clicavel" (click)="abrirModalRegra(); $event.stopPropagation()">
              {{ linha.historico }}
            </td>

            <td class="text-center"><i class="bx bx-file"></i></td>
            <td>{{ linha.nota }}</td>
            <td>{{ linha.cliente }}</td>
            <td><i class="bx bx-paperclip"></i></td>
            <td>
              <span class="status" [ngClass]="linha.status"></span>
            </td>
          </tr>
        </tbody>

      </table>
    </section>


    <!-- Modal Lançamento usando o novo componente -->
    <app-modal-lancamento
      [isVisible]="!!lancamentoSelecionado"
      [lancamento]="lancamentoSelecionado"
      (fechado)="lancamentoSelecionado = null"
      (regrapressed)="abrirModalRegra()"
      (gravado)="onLancamentoGravado($event)">
    </app-modal-lancamento>




    <!-- Modal regra -->
    <div class="modal-regra" *ngIf="modalAberto" (click)="fecharModalRegra()">
      <div class="modal-conteudo-regra" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Associação de Regra</h2>
          <button class="fechar" (click)="fecharModalRegra()">×</button>
        </div>
        <div class="modal-body">
          <div class="linha">
            <div class="date-picker-container">
              <label>Data:</label>
              <div class="custom-date-input" (click)="abrirDatePicker()">
                <span>{{ formatarDataExibicao() }}</span>
                <i class="bx bx-calendar"></i>
              </div>

              <!-- Date Picker Customizado -->
              <div class="custom-date-picker" *ngIf="mostrarDatePicker" (click)="$event.stopPropagation()">
                <div class="date-header">
                  <button type="button" (click)="alterarAno(-1)" class="nav-btn">
                    <i class="bx bx-chevrons-left"></i>
                  </button>
                  <button type="button" (click)="alterarMes(-1)" class="nav-btn">
                    <i class="bx bx-chevron-left"></i>
                  </button>

                  <span class="date-title">{{ meses[mesAtual] }} {{ anoAtual }}</span>

                  <button type="button" (click)="alterarMes(1)" class="nav-btn">
                    <i class="bx bx-chevron-right"></i>
                  </button>
                  <button type="button" (click)="alterarAno(1)" class="nav-btn">
                    <i class="bx bx-chevrons-right"></i>
                  </button>
                </div>

                <div class="date-grid">
                  <div class="day-header">Dom</div>
                  <div class="day-header">Seg</div>
                  <div class="day-header">Ter</div>
                  <div class="day-header">Qua</div>
                  <div class="day-header">Qui</div>
                  <div class="day-header">Sex</div>
                  <div class="day-header">Sáb</div>

                  <div *ngFor="let dia of getDiasDoMes()"
                       class="day-cell"
                       [class.empty]="dia === 0"
                       [class.today]="isToday(dia)"
                       (click)="selecionarDia(dia)">
                    {{ dia || '' }}
                  </div>
                </div>

                <div class="date-footer">
                  <button type="button" (click)="fecharDatePicker()" class="btn-cancel">Fechar</button>
                </div>
              </div>
            </div>
            <div>
              <label>Agência Bancária:</label>
              <input type="text" value="4480/2861" readonly />
            </div>
          </div>
          <div class="linha">
            <div style="flex: 1; display: flex; flex-direction: column; gap: 0.75rem;">
              <div>
                <label>Débito:</label>
                <input type="text" />
              </div>
              <div>
                <label>Crédito:</label>
                <input type="text" />
              </div>
            </div>
            <div class="descricao-inline" style="flex: 1;">
              <label for="descricao">Descrição:</label>
              <select id="descricao">
                <option disabled selected>Selecione uma descrição</option>
                <option>Pagamento Fornecedor</option>
                <option>Transferência Interna</option>
              </select>
            </div>
          </div>
          <div class="linha">
            <div>
              <label>Valor:</label>
              <input type="text" />
            </div>
            <div>
              <label>Expressão:</label>
              <input type="text" />
            </div>
          </div>
          <div class="linha">
            <div style="flex: 1;">
              <label>Histórico Contábil:</label>
              <input type="text" />
            </div>
          </div>
        </div>
        <div class="rodape-modal">
          <button class="btn btn-primary" (click)="fecharModalRegra()">Cancelar</button>
          <button class="btn btn-primary">Gravar</button>
        </div>
      </div>
    </div>


  </main>
</div>
